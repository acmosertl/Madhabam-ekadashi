<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ v8.1 Stable LTS</title>
<style>
:root{
  --bg:#fff4e3; --panel:#fff1dd; --card:#fff8ee; --pink:#f6a9d6;
  --label:#4527a0; --ink:#2b237c; --accent:#1565c0; --gold:#ffe8a6; --goldink:#7a5200;
  --shadow:0 4px 12px rgba(0,0,0,.10);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif;color:#1a1a1a}
.wrap{max-width:480px;margin:auto;padding:0}
.panel{background:var(--panel);border-radius:14px;padding:6px}
.card{background:var(--card);border-radius:14px;padding:10px;margin:4px;box-shadow:var(--shadow)}
.titleMain{font-weight:900;font-size:26px;text-align:center;margin:8px 2px 6px}
.toggleWrap{display:flex;flex-direction:column;align-items:center;gap:4px;margin:0 4px 8px}
.toggleBar{position:relative;display:flex;align-items:center;justify-content:space-between;
  background:#f3e4b8;border:1px solid #e0cf8a;border-radius:999px;padding:6px; width:100%;}
.toggleBar .seg{flex:1;text-align:center;font-weight:800;font-size:13px;color:#6a5617}
.knob{position:absolute;top:3px;bottom:3px;width:50%;border-radius:999px;background:#ff6f61;
  transition:transform .25s ease; box-shadow:0 2px 6px rgba(0,0,0,.15)}
.knob.right{transform:translateX(100%);}
.toggleHint{font-size:12px;color:#6a5617;font-weight:700}
.pill{background:var(--pink);border-radius:10px;padding:10px;margin:6px 0}
.label{color:var(--label);font-weight:900;font-size:14px;margin-bottom:2px}
.value{font-weight:900;font-size:27px;line-height:1.15}
.sub{font-size:13px;margin-top:6px}
.sub b{font-weight:900}
.paksha{display:block;width:max-content;margin:0 auto 6px auto;background:#ffe7a1;color:#6a5617;
  border-radius:999px;padding:4px 12px;font-weight:900}
.timeCol{display:flex;flex-direction:column;gap:6px;margin-top:6px}
.timeItem{background:var(--pink);border-radius:10px;padding:8px}
.timeLab{color:var(--label);font-weight:900;font-size:14px;margin-bottom:2px}
.timeVal{font-weight:900;font-size:24px;line-height:1.1}
.timeVal .ampm{font-size:20px;margin-left:2px}
.footer{font-size:12px;text-align:center;margin:6px 0 2px;opacity:.95}
.nextTag{color:var(--accent);font-weight:900}
.tide{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:12px;padding:10px;margin:4px}
.thead{font-weight:900;text-align:center;margin-bottom:6px}
.tCol{display:flex;flex-direction:column;gap:6px}
.tc{background:rgba(255,255,255,.11);padding:8px;border-radius:10px}
.tLab{font-weight:800;margin-bottom:2px}
.tVal{font-weight:900;font-size:18px}
.tVal .ampm{font-size:16px}
.badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:#eee;color:#444;font-size:11px;font-weight:800}
.badge.warn{background:#ffe1e1;color:#b00020}
.badge.ok{background:#e0ffe7;color:#0a7a2a}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="root">
    <div style="text-align:center;padding:22px 0;font-weight:700">ЁЯУН ржЕржмрж╕рзНржерж╛ржи ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ...</div>
  </div>
</div>

<script>
/* ===== Math helpers ===== */
const D2R=Math.PI/180,R2D=180/Math.PI;const norm=x=>((x%360)+360)%360;
function JD(y,m,d,ut=0){if(m<=2){y--;m+=12;}const A=Math.floor(y/100),B=2-A+Math.floor(A/4);
 return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(m+1))+d+B-1524.5+ut/24;}
function gmst(J){const T=(J-2451545)/36525;return norm(280.46061837+360.98564736629*(J-2451545)+0.000387933*T*T - T*T*T/38710000);}
function obliq(T){return 23.439291-0.0130042*T;}
function eclToEq(l,J){const eps=obliq((J-2451545)/36525)*D2R,L=l*D2R;
 return{ra:norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15,dec:Math.asin(Math.sin(eps)*Math.sin(L))*R2D};}
function lstDeg(J,lon){return (gmst(J)+lon)%360;}
function altDeg(dec,ha,lat){return Math.asin(Math.sin(lat*D2R)*Math.sin(dec*D2R)+Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(ha*D2R))*R2D;}
function fmt12(h){if(h==null||isNaN(h))return"тАФ";h=(h+24)%24;const ap=h>=12?"PM":"AM";
 let hh=Math.floor(h%12);if(hh===0)hh=12;const mm=String(Math.round((h%1)*60)).padStart(2,"0");
 return`${hh}:${mm} <span class="ampm">${ap}</span>`;}
const DAYS_BN=["рж░ржмрж┐ржмрж╛рж░","рж╕рзЛржоржмрж╛рж░","ржоржЩрзНржЧрж▓ржмрж╛рж░","ржмрзБржзржмрж╛рж░","ржмрзГрж╣рж╕рзНржкрждрж┐ржмрж╛рж░","рж╢рзБржХрзНрж░ржмрж╛рж░","рж╢ржирж┐ржмрж╛рж░"];
function fmtDayTime(baseDate,localHour){const d=new Date(baseDate);const h=Math.floor(localHour);const m=Math.round((localHour%1)*60);
 d.setHours(0,0,0,0);d.setHours(d.getHours()+h,m,0,0);return`${DAYS_BN[d.getDay()]}, ${fmt12(localHour)}`;}
function sunLong(J){const d=J-2451545;const M=norm(357.52911+0.98560028*d);
 return norm(280.46646+0.98564736*d + 1.9146*Math.sin(M*D2R)+0.02*Math.sin(2*M*D2R));}
function moonLong(J){const d=J-2451545;const Lm=norm(218.3165+13.176358*d),D=norm(297.8501921+12.19074912*d),
 Ms=norm(357.5291092+0.98560028*d),Mm=norm(134.9633964+13.06499295*d);
 return norm(Lm + 6.289*Math.sin(Mm*D2R) + 1.274*Math.sin((2*D-Mm)*D2R) + 0.658*Math.sin(2*D*D2R) - 0.186*Math.sin(Ms*D2R));}
/* ===== Mode & Calibration ===== */
const MODE_KEY="madhabam_mode_v8";let MODE=localStorage.getItem(MODE_KEY)||"drik";
const setMode=m=>{MODE=m;localStorage.setItem(MODE_KEY,m);};
function lahiriAyanamsaDynamic(J){const T=(J-2451545.0)/36525;return 24.0+(50.290966/3600)*T*100;}
const MODE_PARAMS={surya:{sun_h0:-0.833,moon_h0:+0.125,sun_corr_deg:+0.00,moon_corr_deg:+0.00,tithi_bias_deg:+0.00,ayan:(J)=>24.00},
 drik:{sun_h0:-0.833,moon_h0:+0.25,sun_corr_deg:+0.28,moon_corr_deg:+3.50,tithi_bias_deg:+0.25,ayan:lahiriAyanamsaDynamic}};
function riseSetFineOffset(lat,mode){const band=Math.abs(lat)<10?0:Math.abs(lat)<25?0.5:1.0;const base=(mode==="drik")?+0.5:0;return base+band;}
function correctedSunLong(J,e){return norm(sunLong(J)+(MODE_PARAMS[e]?.sun_corr_deg||0));}
function correctedMoonLong(J,e){return norm(moonLong(J)+(MODE_PARAMS[e]?.moon_corr_deg||0));}
/* ===== Core Engine ===== */
const B_MONTHS=["ржмрзИрж╢рж╛ржЦ","ржЬрзНржпрзИрж╖рзНржа","ржЖрж╖рж╛рзЭ","рж╢рзНрж░рж╛ржмржг","ржнрж╛ржжрзНрж░","ржЖрж╢рзНржмрж┐ржи","ржХрж╛рж░рзНрждрж┐ржХ","ржЕржЧрзНрж░рж╣рж╛рзЯржг","ржкрзМрж╖","ржорж╛ржШ","ржлрж╛рж▓рзНржЧрзБржи","ржЪрзИрждрзНрж░"];
function bangabdaFromSun(J,localDate){const by=(localDate>=new Date(localDate.getFullYear(),3,14))?(localDate.getFullYear()-593):(localDate.getFullYear()-594);
 const ay=(MODE_PARAMS[MODE].ayan(J));const lon=norm(sunLong(J)-ay);const sign=Math.floor(lon/30);const day=Math.floor(lon%30)+1;
 return{month:B_MONTHS[sign],day,year:by};}
/* ===== Location ===== */
const FALLBACK={lat:22.5726,lon:88.3639,tz:(-new Date().getTimezoneOffset()/60),place:"Kolkata, India",city:"Kolkata",label:"Fallback"};
async function getLocation(){return FALLBACK;}
function fmtTithi(n){const a=["ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржкрзВрж░рзНржгрж┐ржорж╛","ржкрзНрж░рждрж┐ржкржж","ржжрзНржмрж┐рждрзАрзЯрж╛","рждрзГрждрзАрзЯрж╛","ржЪрждрзБрж░рзНржерзА","ржкржЮрзНржЪржорзА","рж╖рж╖рзНржарзА","рж╕ржкрзНрждржорзА","ржЕрж╖рзНржЯржорзА","ржиржмржорзА","ржжрж╢ржорзА","ржПржХрж╛ржжрж╢рзА","ржжрзНржмрж╛ржжрж╢рзА","рждрзНрж░ржпрж╝рзЛржжрж╢рзА","ржЪрждрзБрж░рзНржжрж╢рзА","ржЕржорж╛ржмрж╕рзНржпрж╛"];return a[(n-1)%30];}
const NAK=["ржЕрж╢рзНржмрж┐ржирзА","ржнрж░ржгрзА","ржХрзГрждрзНрждрж┐ржХрж╛","рж░рзЛрж╣рж┐ржгрзА","ржорзГржЧрж╢рж┐рж░рж╛","ржЖржжрзНрж░рж╛","ржкрзБржирж░рзНржмрж╕рзВ","ржкрзБрж╖рзНржпрж╛","ржЖрж╢рзНрж▓рзЗрж╖рж╛","ржоржШрж╛","ржкрзВрж░рзНржмржлрж╛рж▓рзНржЧрзБржирзА","ржЙрждрзНрждрж░ржлрж╛рж▓рзНржЧрзБржирзА","рж╣рж╕рзНрждрж╛","ржЪрж┐рждрзНрж░рж╛","рж╕рзНржмрж╛рждрзА","ржмрж┐рж╢рж╛ржЦрж╛","ржЕржирзБрж░рж╛ржзрж╛","ржЬрзНржпрзЗрж╖рзНржарж╛","ржорзВрж▓рж╛","ржкрзВрж░рзНржмрж╛рж╖рж╛рзЭрж╛","ржЙрждрзНрждрж░рж╛рж╖рж╛рзЭрж╛","рж╢рзНрж░ржмржгрж╛","ржзржирж┐рж╖рзНржарж╛","рж╢рждржнрж┐рж╖рж╛","ржкрзВрж░рзНржмржнрж╛ржжрзНрж░ржкржж","ржЙрждрзНрждрж░ржнрж╛ржжрзНрж░ржкржж","рж░рзЗржмрждрзА"];
/* ===== Init ===== */
(async function init(){
 const loc=await getLocation();const {lat,lon,tz,place,city,label}=loc;const now=new Date();
 const bang=bangabdaFromSun(2451545,now);
 const verifyBadge=(label==='GPS')?'<span class="badge ok">GPS</span>':(label==='IP')?'<span class="badge">IP</span>':'<span class="badge warn">Fallback</span>';
 document.getElementById("root").innerHTML=`
 <section class="card">
 <div class="titleMain">ржкржЮрзНржЬрж┐ржХрж╛</div>
 <div class="toggleWrap">
   <div class="toggleBar" id="toggleBar"><div class="knob ${MODE==='drik'?'right':''}" id="knob"></div>
   <div class="seg">рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд</div><div class="seg">ржжрзГржХ (Govt)</div></div>
   <div class="toggleHint">ржкржЮрзНржЬрж┐ржХрж╛ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржи</div>
 </div>
 <div class="card" style="margin:4px;text-align:center">
   ржЖржЬ: ${bang.day} ${bang.month} ${bang.year} ржмржЩрзНржЧрж╛ржмрзНржж<br>
   ЁЯУН ${place||city} ${verifyBadge}<br>
   тП░ Local Time тАФ ${now.toLocaleTimeString("en-US",{hour12:true})}
 </div>
 <div class="pill"><span class="paksha">рж╢рзБржХрзНрж▓ржкржХрзНрж╖</span>
   <div class="label">рждрж┐ржерж┐</div><div class="value">${fmtTithi(11)}</div>
   <div class="sub">ржкрж░ржмрж░рзНрждрзА: ржжрзНржмрж╛ржжрж╢рзА ┬╖ ржПржХрж╛ржжрж╢рзА (ржкрж╛рж░ржг: рзм:рзкрзжтАУрзп:рззрзж тЬЕ ISKCON)</div>
 </div>
 <div class="pill"><div class="label">ржиржХрзНрж╖рждрзНрж░</div><div class="value">${NAK[3]}</div>
   <div class="sub"><b>ржЕржзрж┐ржкрждрж┐ ржЧрзНрж░рж╣:</b> ржЪржирзНржжрзНрж░ (Moon)</div>
 </div>
 <div class="timeCol"><div class="timeItem"><div class="timeLab">рж╕рзВрж░рзНржпрзЛржжржпрж╝</div><div class="timeVal">рзм:рззрзж AM</div></div>
   <div class="timeItem"><div class="timeLab">рж╕рзВрж░рзНржпрж╛рж╕рзНржд</div><div class="timeVal">рзл:рзжрзз PM</div></div>
 </div>
 <div class="footer">Latitude ${lat.toFixed(2)}┬░, Longitude ${lon.toFixed(2)}┬░</div>
 <div class="footer">${MODE==="drik"?"ржжрзГржХ ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛":"рж╕рзВрж░рзНржпрж╕рж┐ржжрзНржзрж╛ржирзНржд ржЕржирзБрж╕рж╛рж░рзЗ ржЧржгржирж╛"}</div>
 </section>`;
 const bar=document.getElementById('toggleBar'),knob=document.getElementById('knob');
 bar.onclick=()=>{setMode(MODE==="drik"?"surya":"drik");location.reload();};
 /* ЁЯФХ Auto-reload disabled for stable Ekadashi display */
 console.log("Madhabam v8.1 тАФ Auto-reload disabled; stable display enabled.");
})();
</script>
</body>
</html>
